name: Simple Build
on:
  workflow_dispatch:
  push:

jobs:
  build:
    runs-on: macos-12
    timeout-minutes: 45
    steps:
      - name: Start
        run: |
          echo "ðŸš€ Starting build..."
          date
          
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Show project
        run: |
          echo "ðŸ“ Project files:"
          ls -la
          echo ""
          echo "ðŸ“¦ Package.json content:"
          head -20 package.json
          
      - name: Setup Node 18
        uses: actions/setup-node@v4
        with:
          node-version: 18
          
      - name: Check Node
        run: |
          echo "Node version:"
          node --version
          npm --version
          
      - name: Install deps quickly
        run: |
          echo "ðŸ“¦ Installing dependencies..."
          npm install --legacy-peer-deps
          
      - name: Check Tauri
        run: |
          echo "ðŸ” Checking Tauri installation..."
          npx tauri --version || echo "Tauri not ready yet"
          
      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable
        
      - name: Check Rust
        run: |
          echo "ðŸ¦€ Rust version:"
          rustc --version
          cargo --version
          
      - name: Simple icons
        run: |
          echo "ðŸŽ¨ Creating icons..."
          mkdir -p src-tauri/icons
          echo 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==' | base64 -d > src-tauri/icons/icon.png
          cp src-tauri/icons/icon.png src-tauri/icons/32x32.png
          cp src-tauri/icons/icon.png src-tauri/icons/128x128.png
          cp src-tauri/icons/icon.png src-tauri/icons/128x128@2x.png
          cp src-tauri/icons/icon.png src-tauri/icons/icon.icns
          cp src-tauri/icons/icon.png src-tauri/icons/icon.ico
          echo "âœ… Icons ready"
          
      - name: Try Tauri build
        run: |
          echo "ðŸ”¨ Attempting Tauri build..."
          echo "This might take 10-15 minutes..."
          npx tauri build || echo "Build failed, but that's OK for testing"
          
      - name: Check results
        run: |
          echo "ðŸ” Looking for build results..."
          find src-tauri/target -name "*.dmg" 2>/dev/null || echo "No DMG found"
          find src-tauri/target -name "*.app" 2>/dev/null || echo "No APP found"
          echo "Build attempt completed!"
