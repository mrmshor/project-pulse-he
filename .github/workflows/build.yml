name: "Build macOS App"

on:
  push:
    branches: [ main ]

jobs:
  build-macos:
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: aarch64-apple-darwin

      - name: Install dependencies
        run: bun install

      - name: Remove icon requirement
        run: |
          # יצירת tauri.conf.json ללא אייקונים
          cat > src-tauri/tauri.conf.json << 'EOF'
          {
            "$schema": "../node_modules/@tauri-apps/cli/schema.json",
            "productName": "project-manager-pro",
            "version": "0.1.0",
            "identifier": "com.projectpulse.app",
            "build": {
              "beforeDevCommand": "bun run dev",
              "beforeBuildCommand": "bun run build",
              "frontendDist": "../dist",
              "devUrl": "http://localhost:5173"
            },
            "app": {
              "windows": [
                {
                  "title": "Project Pulse",
                  "width": 1200,
                  "height": 800
                }
              ],
              "security": {
                "csp": null
              }
            },
            "bundle": {
              "active": true,
              "targets": "all",
              "category": "Productivity"
            }
          }
          EOF

      - name: Build for Apple Silicon Mac  
        run: bun tauri build --target aarch64-apple-darwin

      - name: Upload build
        uses: actions/upload-artifact@v4
        with:
          name: mac-app
          path: src-tauri/target/aarch64-apple-darwin/release/bundle/
